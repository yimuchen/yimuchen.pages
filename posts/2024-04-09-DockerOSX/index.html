<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
		<link href="../../_app/immutable/assets/0.B5G_uDcr.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/5.BUqECbpI.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/2017-02-17-TEXTip_custompackage.BJ_OyN1F.css" rel="stylesheet">
		<link rel="modulepreload" href="../../_app/immutable/entry/start.DMKh2-Gz.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/entry.Bs6jVuSw.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/scheduler.D8jTWijz.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/index.rZpEJ7bn.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/paths.DgIut1lt.js">
		<link rel="modulepreload" href="../../_app/immutable/entry/app.Kk82hatB.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/preload-helper.D6kgxu3v.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/index.MdRYwpiI.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/0.B52s3fD6.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/index.Dmp5BVCV.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/5.Dn3urNUG.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/each.D6YF6ztN.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/posts.CXhWDRWx.js"><title>Running a virtual OSX machine using docker</title><!-- HEAD_svelte-tef83d_START --><!-- HEAD_svelte-tef83d_END -->
  </head>
  <body>
    <div>  <button id="showButton" class="svelte-1h5zt4j"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" class="svg-inline--fa fa-bars " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- HTML_TAG_START --><path fill="currentColor" d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"></path><!-- HTML_TAG_END --></svg></button>  <main> <header style="background-image: url(&quot;../../image/banner/code_head_1.png&quot;);" class="svelte-9cibcw"><h1 class="svelte-9cibcw">Running a virtual OSX machine using docker</h1> <p>2024.Apr.9</p></header> <article class="content-container"><nav class="toc" data-svelte-h="svelte-hoinza"><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#tldr-nearly-copy-and-paste-commands">TLDR; nearly copy and paste commands:</a><ol class="toc-level toc-level-2"><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#step-0---checking-the-dependencies">Step 0 - Checking the dependencies</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#step-1---creating-the-base-image">Step 1 - Creating the base image</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#step-2---extracting-the-generated-image">Step 2 - Extracting the generated image</a></li><li class="toc-item toc-item-h3"><a class="toc-link toc-link-h3" href="#step-3---all-subsequent-runs">Step 3 - All subsequent runs</a></li></ol></li><li class="toc-item toc-item-h2"><a class="toc-link toc-link-h2" href="#some-additional-information">Some additional information</a></li></ol></nav> <p data-svelte-h="svelte-1gmxmg8">Keeping some notes for how to run a OSX virtual machine (with GUI) on a Linux
host to test dependencies on OSX systems. The solution is mainly based on the
instructions found in the <a href="https://github.com/sickcodes/Docker-OSX" rel="nofollow">docker-osx</a> repository, which also
powers the main tool for this.</p> <h2 id="tldr-nearly-copy-and-paste-commands" data-svelte-h="svelte-vz6osx"><a aria-hidden="true" tabindex="-1" href="#tldr-nearly-copy-and-paste-commands"><span class="icon icon-link"></span></a>TLDR; nearly copy and paste commands:</h2> <h3 id="step-0---checking-the-dependencies" data-svelte-h="svelte-d38f1v"><a aria-hidden="true" tabindex="-1" href="#step-0---checking-the-dependencies"><span class="icon icon-link"></span></a>Step 0 - Checking the dependencies</h3> <ul data-svelte-h="svelte-kfizzf"><li><a href="https://docs.docker.com/desktop/install/linux-install/" rel="nofollow"><code>docker</code></a></li> <li><a href="https://wiki.archlinux.org/title/Virt-manager" rel="nofollow"><code>libvirt/virt-manager/qemu</code></a></li> <li><a href="https://wiki.archlinux.org/title/wayland" rel="nofollow">Wayland</a> session (I’m using <a href="https://wiki.archlinux.org/title/KDE" rel="nofollow">Plasma6</a> with wayland for this)</li></ul> <p data-svelte-h="svelte-cig7b3">A copy and paste command from the <a href="https://github.com/sickcodes/Docker-OSX" rel="nofollow">docker-osx</a> repository for all
dependencies other that KDE/wayland, and is listed below (<del>I use Arch BTW</del>)</p> <div class="code-block-container" data-svelte-h="svelte-abimt5"><div class="code-block-header"><span class="code-block-lang">[bash]</span></div> <div class="code-block code-copyable"><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#A6E22E">sudo</span><span style="color:#E6DB74"> pacman</span><span style="color:#AE81FF"> -S</span><span style="color:#E6DB74"> qemu</span><span style="color:#E6DB74"> libvirt</span><span style="color:#E6DB74"> dnsmasq</span><span style="color:#E6DB74"> virt-manager</span><span style="color:#E6DB74"> bridge-utils</span><span style="color:#E6DB74"> flex</span><span style="color:#E6DB74"> bison</span><span style="color:#E6DB74"> iptables-nft</span><span style="color:#E6DB74"> edk2-ovmf</span></span></code></pre></div></div> <h3 id="step-1---creating-the-base-image" data-svelte-h="svelte-bwi01a"><a aria-hidden="true" tabindex="-1" href="#step-1---creating-the-base-image"><span class="icon icon-link"></span></a>Step 1 - Creating the base image</h3> <div class="code-block-container" data-svelte-h="svelte-1r3hr9r"><div class="code-block-header">create base image <span class="code-block-lang">[bash]</span></div> <div class="code-block code-copyable"><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#A6E22E">docker</span><span style="color:#E6DB74"> run</span><span style="color:#AE81FF"> -it</span></span></code></pre></div></div> <p data-svelte-h="svelte-1wskybz">On running this command, you will be prompted with the OSX installer. Here, you
will need to use the disk erase utility for “erase” the largest disk detected.
Do not worry, the size is just and indication of the free space on the host
system, it will not actually wipe your disk, nor will it actually take up the
remaining free space.</p> <p data-svelte-h="svelte-xxpzty">Then follow the installation instructions, then you should arrive at an useable
GUI after following the instructions to completion.</p> <h3 id="step-2---extracting-the-generated-image" data-svelte-h="svelte-1vkfp47"><a aria-hidden="true" tabindex="-1" href="#step-2---extracting-the-generated-image"><span class="icon icon-link"></span></a>Step 2 - Extracting the generated image</h3> <p data-svelte-h="svelte-1ymkmdr">Find the image file corresponding to the hard drive of the OSX.</p> <div class="code-block-container" data-svelte-h="svelte-hvt9e8"><div class="code-block-header"><span class="code-block-lang">[bash]</span></div> <div class="code-block code-copyable"><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#A6E22E">sudo</span><span style="color:#E6DB74"> find</span><span style="color:#E6DB74"> /var/lib/docker</span><span style="color:#AE81FF"> -name</span><span style="color:#E6DB74"> &quot;*.img&quot;</span><span style="color:#AE81FF">  -size</span><span style="color:#E6DB74"> +10G</span></span></code></pre></div></div> <p data-svelte-h="svelte-1qppvn1">You should look for a file path with something like:</p> <div class="code-block-container" data-svelte-h="svelte-1pi867f"><div class="code-block code-copyable"><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2" tabindex="0"><code><span class="line"><span>/var/lib/docker/overlay2/&lt;image_hash&gt;/diff/home/arch/OSX-KVM/mac_hdd_ng.img</span></span></code></pre></div></div> <p data-svelte-h="svelte-dtz1ag">Copy this file to somewhere that you can manage more easily.</p> <h3 id="step-3---all-subsequent-runs" data-svelte-h="svelte-sww1hg"><a aria-hidden="true" tabindex="-1" href="#step-3---all-subsequent-runs"><span class="icon icon-link"></span></a>Step 3 - All subsequent runs</h3> <div class="code-block-container" data-svelte-h="svelte-wdkbtn"><div class="code-block-header">First run <span class="code-block-lang">[bash]</span></div> <div class="code-block code-block-numbered numbered-start-10 code-copyable"><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2" tabindex="0"><code><span class="line" data-line="1"><span style="color:#A6E22E">docker</span><span style="color:#E6DB74"> run</span><span style="color:#AE81FF"> -it</span><span style="color:#AE81FF"> \</span></span>
<span class="line highlight" data-line="2"><span style="color:#AE81FF">    -p</span><span style="color:#E6DB74"> 50922:10022</span><span style="color:#AE81FF"> \</span></span>
<span class="line highlight" data-line="3"><span style="color:#AE81FF">    -e</span><span style="color:#E6DB74"> GENERATE_UNIQUE=</span><span style="color:#AE81FF">true</span><span style="color:#AE81FF"> \</span></span>
<span class="line highlight" data-line="4"><span style="color:#AE81FF">    -e</span><span style="color:#E6DB74"> DISPLAY=&quot;:1&quot;</span><span style="color:#AE81FF"> -e</span><span style="color:#E6DB74"> QT_QPA_PLATFORM=wayland</span><span style="color:#AE81FF"> -e</span><span style="color:#E6DB74"> XDG_RUNTIME_DIR=/tmp</span><span style="color:#AE81FF"> -e</span><span style="color:#E6DB74"> GDK_BACKEND=wayland</span><span style="color:#AE81FF"> -e</span><span style="color:#E6DB74"> CLUTTER_BACKEND=wayland</span><span style="color:#AE81FF"> \</span></span>
<span class="line" data-line="5"><span style="color:#AE81FF">    -e</span><span style="color:#E6DB74"> MASTER_PLIST_URL=&#39;https://raw.githubusercontent.com/sickcodes/osx-serial-generator/master/config-custom-sonoma.plist&#39;</span><span style="color:#AE81FF"> \</span></span>
<span class="line highlight" data-line="6"><span style="color:#E6DB74">    sickcodes/docker-osx:naked</span></span></code></pre></div></div> <p data-svelte-h="svelte-j8lkbu">In particular, notice the additional mount of the image file, and the new
<code>naked</code> tag for the docker image. All subsequent runs will update the OSX image
file, allow for your session to be effectively persistent.</p> <h2 id="some-additional-information" data-svelte-h="svelte-1h8q4jh"><a aria-hidden="true" tabindex="-1" href="#some-additional-information"><span class="icon icon-link"></span></a>Some additional information</h2> <p data-svelte-h="svelte-1edbev7">The main reason for this write-up is the instructions on the <a href="https://github.com/sickcodes/Docker-OSX" rel="nofollow">project
repository</a> assumes the host system uses X11. The instructions for
wayland can be found in the scattered issues page, but has yet to be updated on
the main page (wayland only became the “default” very recently on most desktop
environments). This write is for my own mentally offloading the record of the
instruction that worked for me on my system. As far as I know, the only
difference between the commands on wayland the command are the lines containing
display settings:</p> <div class="code-block-container" data-svelte-h="svelte-1aws1xz"><div class="code-block-header"><span class="code-block-lang">[bash]</span></div> <div class="code-block code-copyable"><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#A6E22E">    -v</span><span style="color:#F8F8F2"> $XDG_RUNTIME_DIR</span><span style="color:#E6DB74">/</span><span style="color:#F8F8F2">$WAYLAND_DISPLAY</span><span style="color:#E6DB74">:/tmp/</span><span style="color:#F8F8F2">$WAYLAND_DISPLAY </span><span style="color:#AE81FF">\</span></span>
<span class="line"><span style="color:#AE81FF">    -e</span><span style="color:#E6DB74"> WAYLAND_DISPLAY=&quot;${</span><span style="color:#F8F8F2">WAYLAND_DISPLAY</span><span style="color:#F92672">:-</span><span style="color:#F8F8F2">wayland-0</span><span style="color:#E6DB74">}&quot;</span><span style="color:#AE81FF"> \</span></span>
<span class="line"><span style="color:#AE81FF">    -e</span><span style="color:#E6DB74"> DISPLAY=&quot;:1&quot;</span><span style="color:#AE81FF"> -e</span><span style="color:#E6DB74"> QT_QPA_PLATFORM=wayland</span><span style="color:#AE81FF"> -e</span><span style="color:#E6DB74"> XDG_RUNTIME_DIR=/tmp</span><span style="color:#AE81FF"> -e</span><span style="color:#E6DB74"> GDK_BACKEND=wayland</span><span style="color:#AE81FF"> -e</span><span style="color:#E6DB74"> CLUTTER_BACKEND=wayland</span><span style="color:#AE81FF"> \</span></span></code></pre></div></div> <p data-svelte-h="svelte-brvg09">Substitute the above to:</p> <div class="code-block-container" data-svelte-h="svelte-l2o09y"><div class="code-block-header"><span class="code-block-lang">[bash]</span></div> <div class="code-block code-copyable"><pre class="shiki monokai" style="background-color:#272822;color:#F8F8F2" tabindex="0"><code><span class="line"><span style="color:#A6E22E">    -v</span><span style="color:#E6DB74"> /tmp/.X11-unix:/tmp/.X11-unix</span><span style="color:#AE81FF"> \</span></span>
<span class="line"><span style="color:#AE81FF">    -e</span><span style="color:#E6DB74"> &quot;DISPLAY=${</span><span style="color:#F8F8F2">DISPLAY</span><span style="color:#F92672">:-:</span><span style="color:#F8F8F2">0</span><span style="color:#E6DB74">.</span><span style="color:#F8F8F2">0</span><span style="color:#E6DB74">}&quot;</span><span style="color:#AE81FF"> \</span></span></code></pre></div></div> <p data-svelte-h="svelte-odmcve">When running on X11 systems.</p></article> <footer class="content-footer svelte-9cibcw"><span class="svelte-9cibcw" data-svelte-h="svelte-fsa5fj">Tags</span><br> <span class="svelte-9cibcw"><a href="../../tags/#computing">computing</a></span><span class="svelte-9cibcw"><a href="../../tags/#notes">notes</a></span></footer></main> <footer class="svelte-18h8dy1"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!-- HTML_TAG_START --><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path><!-- HTML_TAG_END --></svg> <a href="https://github.com/yimuchen/" data-svelte-h="svelte-1lnvvne">Find me on GitHub</a> </footer> 
			
			<script>
				{
					__sveltekit_1wympxs = {
						base: new URL("../..", location).pathname.slice(0, -1),
						assets: "/yimuchen.pages"
					};

					const element = document.currentScript.parentElement;

					const data = [null,null];

					Promise.all([
						import("../../_app/immutable/entry/start.DMKh2-Gz.js"),
						import("../../_app/immutable/entry/app.Kk82hatB.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 5],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
  </body>
</html>
